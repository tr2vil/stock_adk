{
  "annotations": { "list": [] },
  "editable": true,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 1,
  "links": [],
  "panels": [
    {
      "title": "",
      "type": "row",
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 0 },
      "collapsed": false,
      "panels": []
    },
    {
      "title": "분석 요청 수",
      "description": "Orchestrator가 받은 분석 요청 횟수",
      "type": "stat",
      "gridPos": { "h": 4, "w": 4, "x": 0, "y": 1 },
      "datasource": { "type": "loki", "uid": "loki" },
      "targets": [
        {
          "datasource": { "type": "loki", "uid": "loki" },
          "editorMode": "code",
          "expr": "count_over_time({service=\"orchestrator\"} |= \"parallel_analysis_start\" [$__range])",
          "queryType": "instant",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "thresholds": {
            "steps": [
              { "color": "blue", "value": null }
            ]
          }
        },
        "overrides": []
      },
      "options": {
        "colorMode": "value",
        "graphMode": "none",
        "justifyMode": "center",
        "textMode": "value",
        "reduceOptions": { "calcs": ["sum"], "fields": "", "values": false }
      }
    },
    {
      "title": "평균 응답 시간",
      "description": "Sub-Agent 평균 응답 시간",
      "type": "stat",
      "gridPos": { "h": 4, "w": 4, "x": 4, "y": 1 },
      "datasource": { "type": "loki", "uid": "loki" },
      "targets": [
        {
          "datasource": { "type": "loki", "uid": "loki" },
          "editorMode": "code",
          "expr": "avg_over_time({event=\"a2a_response\"} | json | unwrap duration_ms | __error__=\"\" [$__range])",
          "queryType": "instant",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "ms",
          "color": { "mode": "thresholds" },
          "thresholds": {
            "steps": [
              { "color": "green", "value": null },
              { "color": "yellow", "value": 60000 },
              { "color": "red", "value": 120000 }
            ]
          }
        },
        "overrides": []
      },
      "options": {
        "colorMode": "value",
        "graphMode": "none",
        "justifyMode": "center",
        "textMode": "value",
        "reduceOptions": { "calcs": ["mean"], "fields": "", "values": false }
      }
    },
    {
      "title": "에이전트 성공률",
      "description": "Sub-agent 호출 성공 비율",
      "type": "stat",
      "gridPos": { "h": 4, "w": 4, "x": 8, "y": 1 },
      "datasource": { "type": "loki", "uid": "loki" },
      "targets": [
        {
          "datasource": { "type": "loki", "uid": "loki" },
          "editorMode": "code",
          "expr": "count_over_time({service=\"orchestrator\"} |= \"agent_call_success\" [$__range])",
          "legendFormat": "success",
          "queryType": "instant",
          "refId": "A"
        },
        {
          "datasource": { "type": "loki", "uid": "loki" },
          "editorMode": "code",
          "expr": "count_over_time({service=\"orchestrator\"} |= \"agent_call_failed_all_retries\" [$__range])",
          "legendFormat": "failed",
          "queryType": "instant",
          "refId": "B"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "short",
          "color": { "mode": "thresholds" },
          "thresholds": {
            "steps": [
              { "color": "green", "value": null }
            ]
          }
        },
        "overrides": []
      },
      "options": {
        "colorMode": "value",
        "graphMode": "none",
        "justifyMode": "center",
        "textMode": "value_and_name",
        "reduceOptions": { "calcs": ["sum"], "fields": "", "values": false }
      }
    },
    {
      "title": "에러 수",
      "description": "전체 에러 로그 수",
      "type": "stat",
      "gridPos": { "h": 4, "w": 4, "x": 12, "y": 1 },
      "datasource": { "type": "loki", "uid": "loki" },
      "targets": [
        {
          "datasource": { "type": "loki", "uid": "loki" },
          "editorMode": "code",
          "expr": "count_over_time({service=~\"$service\", level=\"error\"} [$__range])",
          "queryType": "instant",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "thresholds": {
            "steps": [
              { "color": "green", "value": null },
              { "color": "yellow", "value": 1 },
              { "color": "red", "value": 5 }
            ]
          }
        },
        "overrides": []
      },
      "options": {
        "colorMode": "value",
        "graphMode": "none",
        "justifyMode": "center",
        "textMode": "value",
        "reduceOptions": { "calcs": ["sum"], "fields": "", "values": false }
      }
    },
    {
      "title": "재시도 수",
      "description": "Sub-agent 호출 재시도 횟수",
      "type": "stat",
      "gridPos": { "h": 4, "w": 4, "x": 16, "y": 1 },
      "datasource": { "type": "loki", "uid": "loki" },
      "targets": [
        {
          "datasource": { "type": "loki", "uid": "loki" },
          "editorMode": "code",
          "expr": "count_over_time({service=\"orchestrator\"} |= \"agent_call_retry\" [$__range])",
          "queryType": "instant",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "thresholds": {
            "steps": [
              { "color": "green", "value": null },
              { "color": "orange", "value": 1 },
              { "color": "red", "value": 10 }
            ]
          }
        },
        "overrides": []
      },
      "options": {
        "colorMode": "value",
        "graphMode": "none",
        "justifyMode": "center",
        "textMode": "value",
        "reduceOptions": { "calcs": ["sum"], "fields": "", "values": false }
      }
    },
    {
      "title": "서비스 상태",
      "description": "최근 로그 발생 여부로 서비스 상태 판단",
      "type": "stat",
      "gridPos": { "h": 4, "w": 4, "x": 20, "y": 1 },
      "datasource": { "type": "loki", "uid": "loki" },
      "targets": [
        {
          "datasource": { "type": "loki", "uid": "loki" },
          "editorMode": "code",
          "expr": "count_over_time({service=~\".+\"} [5m])",
          "legendFormat": "{{service}}",
          "queryType": "instant",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "thresholds": {
            "steps": [
              { "color": "red", "value": null },
              { "color": "green", "value": 1 }
            ]
          },
          "mappings": [
            { "type": "range", "options": { "from": 1, "to": 999999, "result": { "text": "Online" } } },
            { "type": "special", "options": { "match": "null", "result": { "text": "Offline" } } }
          ]
        },
        "overrides": []
      },
      "options": {
        "colorMode": "background",
        "graphMode": "none",
        "justifyMode": "center",
        "textMode": "value_and_name",
        "reduceOptions": { "calcs": ["sum"], "fields": "", "values": false },
        "orientation": "horizontal"
      }
    },
    {
      "title": "에이전트별 응답 시간",
      "type": "row",
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 5 },
      "collapsed": false,
      "panels": []
    },
    {
      "title": "Sub-Agent 응답 시간 (Orchestrator → Agent)",
      "description": "Orchestrator가 각 sub-agent를 호출했을 때의 응답 시간",
      "type": "timeseries",
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 6 },
      "datasource": { "type": "loki", "uid": "loki" },
      "targets": [
        {
          "datasource": { "type": "loki", "uid": "loki" },
          "editorMode": "code",
          "expr": "{service=~\"$service\", event=\"a2a_response\"} | json | unwrap duration_ms | __error__=\"\"",
          "legendFormat": "{{agent}}",
          "queryType": "range",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "unit": "ms",
          "custom": {
            "drawStyle": "points",
            "pointSize": 8,
            "spanNulls": false,
            "showPoints": "always"
          }
        },
        "overrides": []
      },
      "options": {
        "tooltip": { "mode": "multi", "sort": "desc" },
        "legend": { "displayMode": "table", "placement": "right", "calcs": ["mean", "max", "lastNotNull"] }
      }
    },
    {
      "title": "에이전트별 평균 응답 시간",
      "description": "시간대별 에이전트 평균 응답 시간",
      "type": "timeseries",
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 6 },
      "datasource": { "type": "loki", "uid": "loki" },
      "targets": [
        {
          "datasource": { "type": "loki", "uid": "loki" },
          "editorMode": "code",
          "expr": "avg_over_time({service=~\"$service\", event=\"a2a_response\"} | json | unwrap duration_ms | __error__=\"\" [$__interval])",
          "legendFormat": "{{agent}}",
          "queryType": "range",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "unit": "ms",
          "custom": {
            "drawStyle": "line",
            "lineWidth": 2,
            "fillOpacity": 10,
            "spanNulls": false
          }
        },
        "overrides": []
      },
      "options": {
        "tooltip": { "mode": "multi", "sort": "desc" },
        "legend": { "displayMode": "table", "placement": "right", "calcs": ["mean", "max"] }
      }
    },
    {
      "title": "에이전트별 호출 결과",
      "type": "row",
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 14 },
      "collapsed": false,
      "panels": []
    },
    {
      "title": "에이전트별 호출 볼륨",
      "description": "시간대별 에이전트 호출 수",
      "type": "barchart",
      "gridPos": { "h": 7, "w": 12, "x": 0, "y": 15 },
      "datasource": { "type": "loki", "uid": "loki" },
      "targets": [
        {
          "datasource": { "type": "loki", "uid": "loki" },
          "editorMode": "code",
          "expr": "sum by (agent) (count_over_time({service=~\"$service\", event=\"a2a_response\"} | json | __error__=\"\" [$__interval]))",
          "legendFormat": "{{agent}}",
          "queryType": "range",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": { "stacking": { "mode": "normal" } }
        },
        "overrides": []
      },
      "options": {
        "tooltip": { "mode": "multi" },
        "legend": { "displayMode": "list", "placement": "right" }
      }
    },
    {
      "title": "에이전트별 에러 로그",
      "description": "시간대별 에이전트 에러 발생 수",
      "type": "barchart",
      "gridPos": { "h": 7, "w": 12, "x": 12, "y": 15 },
      "datasource": { "type": "loki", "uid": "loki" },
      "targets": [
        {
          "datasource": { "type": "loki", "uid": "loki" },
          "editorMode": "code",
          "expr": "sum by (service) (count_over_time({service=~\"$service\", level=\"error\"} [$__interval]))",
          "legendFormat": "{{service}}",
          "queryType": "range",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": { "stacking": { "mode": "normal" } }
        },
        "overrides": []
      },
      "options": {
        "tooltip": { "mode": "multi" },
        "legend": { "displayMode": "list", "placement": "right" }
      }
    },
    {
      "title": "Orchestrator 로그",
      "type": "row",
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 22 },
      "collapsed": false,
      "panels": []
    },
    {
      "title": "Orchestrator 분석 파이프라인",
      "description": "분석 요청 → sub-agent 호출 → 결과 수집 과정",
      "type": "table",
      "gridPos": { "h": 10, "w": 24, "x": 0, "y": 23 },
      "datasource": { "type": "loki", "uid": "loki" },
      "targets": [
        {
          "datasource": { "type": "loki", "uid": "loki" },
          "editorMode": "code",
          "expr": "{service=\"orchestrator\"} |= \"agent_call\" or \"parallel_analysis\" or \"a2a_request\" or \"a2a_response\" | json | __error__=\"\"",
          "queryType": "range",
          "refId": "A"
        }
      ],
      "transformations": [
        {
          "id": "extractFields",
          "options": { "source": "labels", "format": "auto" }
        },
        {
          "id": "organize",
          "options": {
            "excludeByName": {
              "id": true, "tsNs": true, "labels": true, "Line": true, "line": true,
              "__error__": true, "__error_details__": true,
              "event_extracted": true, "level_extracted": true, "logger_name": true
            },
            "indexByName": {
              "Time": 0, "level": 1, "event": 2, "agent": 3,
              "duration_ms": 4, "response_length": 5, "status": 6,
              "attempt": 7, "ticker": 8, "market": 9, "error": 10
            },
            "renameByName": {
              "Time": "시간", "level": "레벨", "event": "이벤트", "agent": "에이전트",
              "duration_ms": "소요시간(ms)", "response_length": "응답크기",
              "status": "상태", "attempt": "시도", "ticker": "종목", "market": "시장", "error": "에러"
            }
          }
        }
      ],
      "fieldConfig": {
        "defaults": {
          "custom": { "align": "auto", "cellOptions": { "type": "auto" }, "filterable": true, "inspect": true }
        },
        "overrides": [
          {
            "matcher": { "id": "byName", "options": "레벨" },
            "properties": [
              { "id": "custom.width", "value": 80 },
              { "id": "mappings", "value": [
                { "type": "value", "options": { "error": { "text": "ERROR", "color": "red" } } },
                { "type": "value", "options": { "warning": { "text": "WARN", "color": "yellow" } } },
                { "type": "value", "options": { "info": { "text": "INFO", "color": "green" } } }
              ]},
              { "id": "custom.cellOptions", "value": { "type": "color-text" } }
            ]
          },
          {
            "matcher": { "id": "byName", "options": "소요시간(ms)" },
            "properties": [
              { "id": "unit", "value": "ms" }, { "id": "custom.width", "value": 120 },
              { "id": "thresholds", "value": { "mode": "absolute", "steps": [
                { "color": "green", "value": null }, { "color": "yellow", "value": 30000 }, { "color": "red", "value": 60000 }
              ]}},
              { "id": "custom.cellOptions", "value": { "type": "color-text" } }
            ]
          },
          {
            "matcher": { "id": "byName", "options": "응답크기" },
            "properties": [{ "id": "unit", "value": "decbytes" }, { "id": "custom.width", "value": 100 }]
          },
          {
            "matcher": { "id": "byName", "options": "시간" },
            "properties": [{ "id": "custom.width", "value": 170 }]
          },
          {
            "matcher": { "id": "byName", "options": "이벤트" },
            "properties": [{ "id": "custom.width", "value": 180 }]
          },
          {
            "matcher": { "id": "byName", "options": "시도" },
            "properties": [{ "id": "custom.width", "value": 60 }]
          }
        ]
      },
      "options": {
        "showHeader": true,
        "sortBy": [{ "desc": true, "displayName": "시간" }],
        "cellHeight": "sm",
        "footer": { "show": true, "countRows": true, "reducer": ["count"] }
      }
    },
    {
      "title": "개별 에이전트 로그",
      "type": "row",
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 33 },
      "collapsed": false,
      "panels": []
    },
    {
      "title": "에이전트별 로그 레벨 분포",
      "description": "에이전트별 info / warning / error 로그 비율",
      "type": "barchart",
      "gridPos": { "h": 7, "w": 12, "x": 0, "y": 34 },
      "datasource": { "type": "loki", "uid": "loki" },
      "targets": [
        {
          "datasource": { "type": "loki", "uid": "loki" },
          "editorMode": "code",
          "expr": "sum by (service, level) (count_over_time({service=~\"$service\"} | json | level=~\"$level\" | __error__=\"\" [$__interval]))",
          "legendFormat": "{{service}} / {{level}}",
          "queryType": "range",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": { "stacking": { "mode": "normal" } }
        },
        "overrides": [
          {
            "matcher": { "id": "byRegexp", "options": ".*error.*" },
            "properties": [{ "id": "color", "value": { "fixedColor": "red", "mode": "fixed" } }]
          },
          {
            "matcher": { "id": "byRegexp", "options": ".*warning.*" },
            "properties": [{ "id": "color", "value": { "fixedColor": "yellow", "mode": "fixed" } }]
          }
        ]
      },
      "options": {
        "tooltip": { "mode": "multi" },
        "legend": { "displayMode": "list", "placement": "right" }
      }
    },
    {
      "title": "에이전트별 처리 시간 분포",
      "description": "각 에이전트의 응답 시간 히트맵",
      "type": "timeseries",
      "gridPos": { "h": 7, "w": 12, "x": 12, "y": 34 },
      "datasource": { "type": "loki", "uid": "loki" },
      "targets": [
        {
          "datasource": { "type": "loki", "uid": "loki" },
          "editorMode": "code",
          "expr": "quantile_over_time(0.5, {service=~\"$service\", event=\"a2a_response\"} | json | unwrap duration_ms | __error__=\"\" [$__interval]) by (agent)",
          "legendFormat": "{{agent}} p50",
          "queryType": "range",
          "refId": "A"
        },
        {
          "datasource": { "type": "loki", "uid": "loki" },
          "editorMode": "code",
          "expr": "quantile_over_time(0.95, {service=~\"$service\", event=\"a2a_response\"} | json | unwrap duration_ms | __error__=\"\" [$__interval]) by (agent)",
          "legendFormat": "{{agent}} p95",
          "queryType": "range",
          "refId": "B"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "unit": "ms",
          "custom": {
            "drawStyle": "line",
            "lineWidth": 2,
            "fillOpacity": 5,
            "spanNulls": false
          }
        },
        "overrides": [
          {
            "matcher": { "id": "byRegexp", "options": ".*p95.*" },
            "properties": [{ "id": "custom.lineStyle", "value": { "fill": "dash", "dash": [10, 5] } }]
          }
        ]
      },
      "options": {
        "tooltip": { "mode": "multi", "sort": "desc" },
        "legend": { "displayMode": "table", "placement": "right", "calcs": ["mean", "max"] }
      }
    },
    {
      "title": "에이전트별 응답 크기 추이",
      "description": "각 에이전트의 응답 크기 변화",
      "type": "timeseries",
      "gridPos": { "h": 7, "w": 12, "x": 0, "y": 41 },
      "datasource": { "type": "loki", "uid": "loki" },
      "targets": [
        {
          "datasource": { "type": "loki", "uid": "loki" },
          "editorMode": "code",
          "expr": "{service=~\"$service\", event=\"a2a_response\"} | json | unwrap response_length | __error__=\"\"",
          "legendFormat": "{{agent}}",
          "queryType": "range",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "unit": "decbytes",
          "custom": {
            "drawStyle": "bars",
            "barWidthFactor": 0.5,
            "fillOpacity": 80,
            "stacking": { "mode": "none" }
          }
        },
        "overrides": []
      },
      "options": {
        "tooltip": { "mode": "multi", "sort": "desc" },
        "legend": { "displayMode": "table", "placement": "right", "calcs": ["mean", "max", "lastNotNull"] }
      }
    },
    {
      "title": "에이전트별 성공/실패 비율",
      "description": "각 에이전트의 호출 성공 vs 실패 수",
      "type": "barchart",
      "gridPos": { "h": 7, "w": 12, "x": 12, "y": 41 },
      "datasource": { "type": "loki", "uid": "loki" },
      "targets": [
        {
          "datasource": { "type": "loki", "uid": "loki" },
          "editorMode": "code",
          "expr": "sum by (agent) (count_over_time({service=\"orchestrator\"} |= \"agent_call_success\" | json | __error__=\"\" [$__range]))",
          "legendFormat": "{{agent}} (성공)",
          "queryType": "instant",
          "refId": "A"
        },
        {
          "datasource": { "type": "loki", "uid": "loki" },
          "editorMode": "code",
          "expr": "sum by (agent) (count_over_time({service=\"orchestrator\"} |= \"agent_call_failed_all_retries\" | json | __error__=\"\" [$__range]))",
          "legendFormat": "{{agent}} (실패)",
          "queryType": "instant",
          "refId": "B"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": { "stacking": { "mode": "normal" } }
        },
        "overrides": [
          {
            "matcher": { "id": "byRegexp", "options": ".*실패.*" },
            "properties": [{ "id": "color", "value": { "fixedColor": "red", "mode": "fixed" } }]
          },
          {
            "matcher": { "id": "byRegexp", "options": ".*성공.*" },
            "properties": [{ "id": "color", "value": { "fixedColor": "green", "mode": "fixed" } }]
          }
        ]
      },
      "options": {
        "tooltip": { "mode": "multi" },
        "legend": { "displayMode": "list", "placement": "right" },
        "orientation": "horizontal"
      }
    },
    {
      "title": "에이전트 로그 테이블",
      "description": "에이전트 로그를 테이블 형태로 조회 (JSON 필드를 컬럼으로 표시)",
      "type": "table",
      "gridPos": { "h": 14, "w": 24, "x": 0, "y": 48 },
      "datasource": { "type": "loki", "uid": "loki" },
      "targets": [
        {
          "datasource": { "type": "loki", "uid": "loki" },
          "editorMode": "code",
          "expr": "{service=~\"$service\"} | json | level=~\"$level\" | __error__=\"\"",
          "queryType": "range",
          "refId": "A"
        }
      ],
      "transformations": [
        {
          "id": "extractFields",
          "options": {
            "source": "labels",
            "format": "auto"
          }
        },
        {
          "id": "organize",
          "options": {
            "excludeByName": {
              "id": true,
              "tsNs": true,
              "labels": true,
              "Line": true,
              "line": true,
              "__error__": true,
              "__error_details__": true,
              "event_extracted": true,
              "level_extracted": true,
              "logger_name": true
            },
            "indexByName": {
              "Time": 0,
              "service": 1,
              "level": 2,
              "event": 3,
              "agent": 4,
              "duration_ms": 5,
              "response_length": 6,
              "status": 7,
              "attempt": 8,
              "error": 9,
              "response_preview": 10
            },
            "renameByName": {
              "Time": "시간",
              "service": "서비스",
              "level": "레벨",
              "event": "이벤트",
              "agent": "에이전트",
              "duration_ms": "소요시간(ms)",
              "response_length": "응답크기",
              "status": "상태",
              "attempt": "시도",
              "error": "에러",
              "response_preview": "응답 미리보기"
            }
          }
        }
      ],
      "fieldConfig": {
        "defaults": {
          "custom": {
            "align": "auto",
            "cellOptions": { "type": "auto" },
            "filterable": true,
            "inspect": true
          }
        },
        "overrides": [
          {
            "matcher": { "id": "byName", "options": "레벨" },
            "properties": [
              { "id": "custom.width", "value": 80 },
              {
                "id": "mappings",
                "value": [
                  { "type": "value", "options": { "error": { "text": "ERROR", "color": "red" } } },
                  { "type": "value", "options": { "warning": { "text": "WARN", "color": "yellow" } } },
                  { "type": "value", "options": { "info": { "text": "INFO", "color": "green" } } }
                ]
              },
              { "id": "custom.cellOptions", "value": { "type": "color-text" } }
            ]
          },
          {
            "matcher": { "id": "byName", "options": "소요시간(ms)" },
            "properties": [
              { "id": "unit", "value": "ms" },
              { "id": "custom.width", "value": 120 },
              {
                "id": "thresholds",
                "value": {
                  "mode": "absolute",
                  "steps": [
                    { "color": "green", "value": null },
                    { "color": "yellow", "value": 30000 },
                    { "color": "red", "value": 60000 }
                  ]
                }
              },
              { "id": "custom.cellOptions", "value": { "type": "color-text" } }
            ]
          },
          {
            "matcher": { "id": "byName", "options": "응답크기" },
            "properties": [
              { "id": "unit", "value": "decbytes" },
              { "id": "custom.width", "value": 100 }
            ]
          },
          {
            "matcher": { "id": "byName", "options": "서비스" },
            "properties": [
              { "id": "custom.width", "value": 140 }
            ]
          },
          {
            "matcher": { "id": "byName", "options": "이벤트" },
            "properties": [
              { "id": "custom.width", "value": 160 }
            ]
          },
          {
            "matcher": { "id": "byName", "options": "에이전트" },
            "properties": [
              { "id": "custom.width", "value": 130 }
            ]
          },
          {
            "matcher": { "id": "byName", "options": "시간" },
            "properties": [
              { "id": "custom.width", "value": 170 }
            ]
          },
          {
            "matcher": { "id": "byName", "options": "시도" },
            "properties": [
              { "id": "custom.width", "value": 60 }
            ]
          },
          {
            "matcher": { "id": "byName", "options": "상태" },
            "properties": [
              { "id": "custom.width", "value": 70 }
            ]
          },
          {
            "matcher": { "id": "byName", "options": "응답 미리보기" },
            "properties": [
              { "id": "custom.width", "value": 300 },
              { "id": "custom.cellOptions", "value": { "type": "auto" } }
            ]
          }
        ]
      },
      "options": {
        "showHeader": true,
        "sortBy": [{ "desc": true, "displayName": "시간" }],
        "cellHeight": "sm",
        "footer": {
          "show": true,
          "countRows": true,
          "reducer": ["count"]
        }
      }
    },
    {
      "title": "에러 및 재시도",
      "type": "row",
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 46 },
      "collapsed": false,
      "panels": []
    },
    {
      "title": "에러 상세 로그",
      "description": "전체 에러 로그 (재시도 포함)",
      "type": "table",
      "gridPos": { "h": 10, "w": 24, "x": 0, "y": 63 },
      "datasource": { "type": "loki", "uid": "loki" },
      "targets": [
        {
          "datasource": { "type": "loki", "uid": "loki" },
          "editorMode": "code",
          "expr": "{service=~\"$service\"} |= \"error\" or \"retry\" or \"timeout\" or \"failed\" | json | __error__=\"\"",
          "queryType": "range",
          "refId": "A"
        }
      ],
      "transformations": [
        {
          "id": "extractFields",
          "options": { "source": "labels", "format": "auto" }
        },
        {
          "id": "organize",
          "options": {
            "excludeByName": {
              "id": true, "tsNs": true, "labels": true, "Line": true, "line": true,
              "__error__": true, "__error_details__": true,
              "event_extracted": true, "level_extracted": true, "logger_name": true
            },
            "indexByName": {
              "Time": 0, "service": 1, "level": 2, "event": 3, "agent": 4,
              "error": 5, "last_error": 6, "attempt": 7, "retries": 8,
              "duration_ms": 9, "timeout": 10, "url": 11
            },
            "renameByName": {
              "Time": "시간", "service": "서비스", "level": "레벨", "event": "이벤트",
              "agent": "에이전트", "error": "에러", "last_error": "최종 에러",
              "attempt": "시도", "retries": "재시도 횟수",
              "duration_ms": "소요시간(ms)", "timeout": "타임아웃(s)", "url": "URL"
            }
          }
        }
      ],
      "fieldConfig": {
        "defaults": {
          "custom": { "align": "auto", "cellOptions": { "type": "auto" }, "filterable": true, "inspect": true }
        },
        "overrides": [
          {
            "matcher": { "id": "byName", "options": "레벨" },
            "properties": [
              { "id": "custom.width", "value": 80 },
              { "id": "mappings", "value": [
                { "type": "value", "options": { "error": { "text": "ERROR", "color": "red" } } },
                { "type": "value", "options": { "warning": { "text": "WARN", "color": "yellow" } } },
                { "type": "value", "options": { "info": { "text": "INFO", "color": "green" } } }
              ]},
              { "id": "custom.cellOptions", "value": { "type": "color-text" } }
            ]
          },
          {
            "matcher": { "id": "byName", "options": "에러" },
            "properties": [
              { "id": "custom.width", "value": 300 },
              { "id": "color", "value": { "fixedColor": "red", "mode": "fixed" } },
              { "id": "custom.cellOptions", "value": { "type": "color-text" } }
            ]
          },
          {
            "matcher": { "id": "byName", "options": "최종 에러" },
            "properties": [
              { "id": "custom.width", "value": 250 },
              { "id": "color", "value": { "fixedColor": "red", "mode": "fixed" } },
              { "id": "custom.cellOptions", "value": { "type": "color-text" } }
            ]
          },
          {
            "matcher": { "id": "byName", "options": "시간" },
            "properties": [{ "id": "custom.width", "value": 170 }]
          },
          {
            "matcher": { "id": "byName", "options": "이벤트" },
            "properties": [{ "id": "custom.width", "value": 200 }]
          },
          {
            "matcher": { "id": "byName", "options": "시도" },
            "properties": [{ "id": "custom.width", "value": 60 }]
          }
        ]
      },
      "options": {
        "showHeader": true,
        "sortBy": [{ "desc": true, "displayName": "시간" }],
        "cellHeight": "sm",
        "footer": { "show": true, "countRows": true, "reducer": ["count"] }
      }
    }
  ],
  "refresh": "10s",
  "schemaVersion": 39,
  "tags": ["trading", "agents", "operations"],
  "templating": {
    "list": [
      {
        "current": { "selected": true, "text": "All", "value": "$__all" },
        "datasource": { "type": "loki", "uid": "loki" },
        "definition": "label_values(service)",
        "includeAll": true,
        "multi": true,
        "name": "service",
        "label": "Service",
        "query": "label_values(service)",
        "refresh": 2,
        "type": "query"
      },
      {
        "current": { "selected": true, "text": "All", "value": "$__all" },
        "includeAll": true,
        "multi": true,
        "name": "level",
        "label": "Log Level",
        "type": "custom",
        "query": "info,warning,error",
        "options": [
          { "selected": false, "text": "info", "value": "info" },
          { "selected": false, "text": "warning", "value": "warning" },
          { "selected": false, "text": "error", "value": "error" }
        ]
      }
    ]
  },
  "time": { "from": "now-1h", "to": "now" },
  "timepicker": {},
  "timezone": "browser",
  "title": "Agent Operations",
  "uid": "agent-operations",
  "version": 1
}
